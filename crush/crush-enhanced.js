// ğŸ’– NAMERLY CRUSH ENHANCED MESSAGES & FUNCTIONALITY
// Additional message types and personalization features

// Extended message types with new categories
const enhancedMessages = {
  en: {
    first_message: [
      "Hey! I've been wanting to text you for a while ğŸ˜Š",
      "Hi! Hope you don't mind me reaching out, but I think you're really cool",
      "Hey! I know we don't talk much, but I'd love to change that",
      "Hi! I've been thinking about our conversation and wanted to continue it",
      "Hey! I hope this doesn't sound weird, but I really enjoy talking to you",
      "Hi! I saw something today and it reminded me of you",
      "Hey! I've been wanting to get to know you better",
      "Hi! I hope you're having a great day - you deserve it!",
      "Hey! I couldn't stop thinking about that thing you said about...",
      "Hi! I know this is random, but I really like your energy"
    ],
    good_morning: [
      "Good morning! Hope your day is as amazing as you are â˜€ï¸",
      "Morning! Just wanted to say you're the first thing I thought of today",
      "Good morning sunshine! Hope you slept well ğŸ’«",
      "Morning! Sending you positive vibes for an awesome day",
      "Good morning! I hope today brings you lots of reasons to smile",
      "Morning beautiful! Hope you have the best day ever",
      "Good morning! Can't wait to hear about your day later",
      "Morning! Hope your coffee is strong and your day is sweet",
      "Good morning! You make every day feel like a fresh start",
      "Morning! Hope today is filled with all your favorite things"
    ],
    good_night: [
      "Good night! Sweet dreams about all the good things coming your way ğŸŒ™",
      "Sleep well! Hope you wake up feeling amazing tomorrow",
      "Good night! Thanks for making today brighter just by being you",
      "Sweet dreams! Can't wait to talk to you again soon",
      "Good night! Hope your dreams are as beautiful as your smile",
      "Sleep tight! Tomorrow's another chance for something awesome",
      "Good night! Rest well, you deserve all the peace in the world",
      "Sweet dreams! Hope you sleep as peacefully as you make me feel",
      "Good night! Looking forward to another day of your amazing energy",
      "Sleep well! Dream about all the adventures waiting for you"
    ],
    flirty: [
      "If being gorgeous was a crime, you'd be serving a life sentence ğŸ˜",
      "I must be a snowflake because I've fallen for you â„ï¸",
      "Do you have a map? I keep getting lost in your eyes",
      "Are you WiFi? Because I'm feeling a connection ğŸ“¶",
      "If you were words on a page, you'd be fine print ğŸ˜‰",
      "Is it hot in here or is it just you?",
      "I was wondering if you had an extra heart, because mine was just stolen",
      "Do you believe in love at first sight, or should I walk by again?",
      "Are you a time traveler? Because I see you in my future",
      "If kisses were raindrops, I'd send you a storm ğŸ’‹"
    ],
    sweet: [
      "You have this way of making everything feel better ğŸ¥°",
      "I love how you light up when you talk about things you're passionate about",
      "Your kindness is one of the most beautiful things about you",
      "You make my heart feel so full and happy ğŸ’•",
      "I admire how genuine and real you are",
      "You have such a beautiful soul, it shows in everything you do",
      "The way you care about others is really inspiring",
      "You make me want to be a better person just by being yourself",
      "Your laugh is my favorite sound in the world",
      "You're not just beautiful, you're beautiful inside and out"
    ],
    funny: [
      "Are you a parking ticket? Because you've got FINE written all over you ğŸ˜‚",
      "I'd tell you a joke about chemistry, but I know we already have it",
      "Are you Google? Because you have everything I've been searching for",
      "I must be a photographer because I can picture us together ğŸ“¸",
      "Are you a bank loan? Because you have my interest!",
      "If you were a vegetable, you'd be a cute-cumber ğŸ¥’",
      "Are you my appendix? Because I have this gut feeling I should take you out",
      "Do you like Star Wars? Because Yoda one for me!",
      "Are you a campfire? Because you're hot and I want s'more",
      "If you were a fruit, you'd be a fineapple ğŸ"
    ],
    deep: [
      "What's something that's been on your mind lately? I'd love to hear your thoughts",
      "If you could change one thing about the world, what would it be?",
      "What's a dream you have that you've never told anyone?",
      "What makes you feel most alive and excited about life?",
      "If you could have dinner with anyone, dead or alive, who would it be?",
      "What's the best advice you've ever received?",
      "What's something you're really passionate about that most people don't know?",
      "If you could travel anywhere in the world, where would you go and why?",
      "What's a moment in your life that really changed your perspective?",
      "What do you think is the most important thing in life?"
    ]
  },
  es: {
    first_message: [
      "Â¡Hola! He estado queriendo escribirte hace un tiempo ğŸ˜Š",
      "Â¡Hola! Espero no te moleste que te escriba, pero me pareces sÃºper genial",
      "Â¡Hey! SÃ© que no hablamos mucho, pero me gustarÃ­a cambiar eso",
      "Â¡Hola! He estado pensando en nuestra conversaciÃ³n y querÃ­a continuarla",
      "Â¡Hey! Espero no suene raro, pero me gusta mucho hablar contigo",
      "Â¡Hola! Vi algo hoy y me recordÃ³ a ti",
      "Â¡Hey! He estado queriendo conocerte mejor",
      "Â¡Hola! Espero estÃ©s teniendo un gran dÃ­a - te lo mereces!",
      "Â¡Hey! No pude dejar de pensar en eso que dijiste sobre...",
      "Â¡Hola! SÃ© que es random, pero me gusta mucho tu energÃ­a"
    ],
    good_morning: [
      "Â¡Buenos dÃ­as! Espero tu dÃ­a sea tan increÃ­ble como tÃº â˜€ï¸",
      "Â¡Buenos dÃ­as! Solo querÃ­a decirte que fuiste lo primero en lo que pensÃ© hoy",
      "Â¡Buenos dÃ­as sol! Espero hayas dormido bien ğŸ’«",
      "Â¡Buenos dÃ­as! Te mando buenas vibras para un dÃ­a genial",
      "Â¡Buenos dÃ­as! Espero hoy te traiga muchas razones para sonreÃ­r",
      "Â¡Buenos dÃ­as hermosa! Espero tengas el mejor dÃ­a",
      "Â¡Buenos dÃ­as! No puedo esperar a saber cÃ³mo estuvo tu dÃ­a",
      "Â¡Buenos dÃ­as! Espero tu cafÃ© estÃ© fuerte y tu dÃ­a dulce",
      "Â¡Buenos dÃ­as! Haces que cada dÃ­a se sienta como un nuevo comienzo",
      "Â¡Buenos dÃ­as! Espero hoy estÃ© lleno de todas tus cosas favoritas"
    ],
    good_night: [
      "Â¡Buenas noches! Dulces sueÃ±os sobre todas las cosas buenas que vienen ğŸŒ™",
      "Â¡Que duermas bien! Espero despiertes sintiÃ©ndote increÃ­ble maÃ±ana",
      "Â¡Buenas noches! Gracias por hacer el dÃ­a mÃ¡s brillante solo siendo tÃº",
      "Â¡Dulces sueÃ±os! No puedo esperar a hablar contigo pronto",
      "Â¡Buenas noches! Espero tus sueÃ±os sean tan hermosos como tu sonrisa",
      "Â¡Que duermas bien! MaÃ±ana es otra oportunidad para algo increÃ­ble",
      "Â¡Buenas noches! Descansa bien, te mereces toda la paz del mundo",
      "Â¡Dulces sueÃ±os! Espero duermas tan tranquila como me haces sentir",
      "Â¡Buenas noches! Espero con ansias otro dÃ­a de tu energÃ­a increÃ­ble",
      "Â¡Que duermas bien! SueÃ±a con todas las aventuras que te esperan"
    ],
    flirty: [
      "Si ser hermosa fuera un crimen, estarÃ­as cumpliendo cadena perpetua ğŸ˜",
      "Debo ser un copo de nieve porque me enamorÃ© de ti â„ï¸",
      "Â¿Tienes un mapa? Porque me pierdo en tus ojos",
      "Â¿Eres WiFi? Porque siento una conexiÃ³n ğŸ“¶",
      "Si fueras palabras en una pÃ¡gina, serÃ­as letra pequeÃ±a ğŸ˜‰",
      "Â¿Hace calor aquÃ­ o eres tÃº?",
      "Me preguntaba si tenÃ­as un corazÃ³n extra, porque el mÃ­o fue robado",
      "Â¿Crees en el amor a primera vista, o deberÃ­a pasar otra vez?",
      "Â¿Eres una viajera del tiempo? Porque te veo en mi futuro",
      "Si los besos fueran gotas de lluvia, te enviarÃ­a una tormenta ğŸ’‹"
    ],
    sweet: [
      "Tienes esta forma de hacer que todo se sienta mejor ğŸ¥°",
      "Me encanta cÃ³mo te iluminas cuando hablas de cosas que te apasionan",
      "Tu bondad es una de las cosas mÃ¡s hermosas de ti",
      "Haces que mi corazÃ³n se sienta tan lleno y feliz ğŸ’•",
      "Admiro lo genuina y real que eres",
      "Tienes un alma tan hermosa, se nota en todo lo que haces",
      "La forma en que te preocupas por otros es realmente inspiradora",
      "Me haces querer ser mejor persona solo siendo tÃº misma",
      "Tu risa es mi sonido favorito en el mundo",
      "No solo eres hermosa por fuera, eres hermosa por dentro y por fuera"
    ],
    funny: [
      "Â¿Eres una multa de trÃ¡nsito? Porque tienes HERMOSA escrito por todos lados ğŸ˜‚",
      "Te contarÃ­a un chiste de quÃ­mica, pero sÃ© que ya la tenemos",
      "Â¿Eres Google? Porque tienes todo lo que he estado buscando",
      "Debo ser fotÃ³grafo porque puedo vernos juntos ğŸ“¸",
      "Â¿Eres un prÃ©stamo bancario? Â¡Porque tienes mi interÃ©s!",
      "Si fueras una verdura, serÃ­as una linda-horia ğŸ¥’",
      "Â¿Eres mi apÃ©ndice? Porque tengo la sensaciÃ³n de que deberÃ­a sacarte",
      "Â¿Te gusta Star Wars? Â¡Porque Yoda eres la indicada para mÃ­!",
      "Â¿Eres una fogata? Porque estÃ¡s caliente y quiero mÃ¡s",
      "Si fueras una fruta, serÃ­as una linda-Ã±a ğŸ"
    ],
    deep: [
      "Â¿QuÃ© es algo que has estado pensando Ãºltimamente? Me encantarÃ­a escuchar tus pensamientos",
      "Si pudieras cambiar una cosa del mundo, Â¿quÃ© serÃ­a?",
      "Â¿CuÃ¡l es un sueÃ±o que tienes que nunca le has contado a nadie?",
      "Â¿QuÃ© te hace sentir mÃ¡s viva y emocionada por la vida?",
      "Si pudieras cenar con cualquier persona, viva o muerta, Â¿quiÃ©n serÃ­a?",
      "Â¿CuÃ¡l es el mejor consejo que has recibido?",
      "Â¿QuÃ© es algo que te apasiona mucho que la mayorÃ­a no sabe?",
      "Si pudieras viajar a cualquier lugar del mundo, Â¿adÃ³nde irÃ­as y por quÃ©?",
      "Â¿CuÃ¡l es un momento en tu vida que realmente cambiÃ³ tu perspectiva?",
      "Â¿QuÃ© crees que es lo mÃ¡s importante en la vida?"
    ]
  }
};

// Crush tips database
const crushTips = {
  en: [
    "ğŸ’– Tip: Be yourself! Authenticity is more attractive than trying to be someone you're not.",
    "âœ¨ Tip: Show genuine interest in their hobbies and passions.",
    "ğŸ˜Š Tip: A genuine compliment about their personality goes further than looks.",
    "ğŸ’¬ Tip: Ask open-ended questions to keep conversations flowing naturally.",
    "ğŸµ Tip: Share music or memes that remind you of them - it's a sweet gesture!",
    "â° Tip: Don't overthink response times - be natural with your texting pace.",
    "ğŸŒŸ Tip: Remember small details they mention - it shows you really listen.",
    "ğŸ’• Tip: Be supportive during their tough times - kindness is incredibly attractive.",
    "ğŸ­ Tip: Use humor, but read the room - timing is everything!",
    "ğŸš€ Tip: Be confident but not pushy - respect their space and boundaries."
  ],
  es: [
    "ğŸ’– Consejo: Â¡SÃ© tÃº mismo! La autenticidad es mÃ¡s atractiva que fingir ser alguien que no eres.",
    "âœ¨ Consejo: Muestra interÃ©s genuino en sus hobbies y pasiones.",
    "ğŸ˜Š Consejo: Un cumplido genuino sobre su personalidad llega mÃ¡s lejos que sobre su apariencia.",
    "ğŸ’¬ Consejo: Haz preguntas abiertas para mantener las conversaciones fluyendo naturalmente.",
    "ğŸµ Consejo: Comparte mÃºsica o memes que te recuerden a esa persona - Â¡es un gesto dulce!",
    "â° Consejo: No pienses demasiado en los tiempos de respuesta - sÃ© natural con tu ritmo de mensajes.",
    "ğŸŒŸ Consejo: Recuerda pequeÃ±os detalles que mencionen - muestra que realmente escuchas.",
    "ğŸ’• Consejo: SÃ© comprensivo durante sus momentos difÃ­ciles - la bondad es increÃ­blemente atractiva.",
    "ğŸ­ Consejo: Usa el humor, pero lee el ambiente - Â¡el timing es todo!",
    "ğŸš€ Consejo: SÃ© confiado pero no insistente - respeta su espacio y lÃ­mites."
  ]
};

// Context-based message modifications
const contextModifiers = {
  en: {
    story_reply: (msg) => `Saw your story and ${msg.toLowerCase()}`,
    after_date: (msg) => `Had such a great time earlier! ${msg}`,
    long_time: (msg) => `It's been a while, but ${msg.toLowerCase()}`,
    group_chat: (msg) => `Hey! From our group chat: ${msg.toLowerCase()}`,
    social_media: (msg) => `Loved your recent post! ${msg}`
  },
  es: {
    story_reply: (msg) => `Vi tu historia y ${msg.toLowerCase()}`,
    after_date: (msg) => `Â¡La pasÃ© sÃºper bien! ${msg}`,
    long_time: (msg) => `Ha pasado un tiempo, pero ${msg.toLowerCase()}`,
    group_chat: (msg) => `Â¡Hey! Del grupo: ${msg.toLowerCase()}`,
    social_media: (msg) => `Â¡Me encantÃ³ tu post! ${msg}`
  }
};

// Enhanced message generation with personalization
function generateEnhancedMessage() {
  // Access global variables properly - they should be defined in the main HTML
  const currentLang = window.currentLang || localStorage.getItem('namerly-crush-lang') || 'en';
  const messages = window.messages;
  const translations = window.translations;
  
  if (!messages || !translations) {
    console.error('Global variables not available, falling back to original function');
    if (typeof generateMessage === 'function') {
      generateMessage();
      return;
    }
  }
  
  const type = document.getElementById("type").value;
  const mood = document.querySelector('.mood-btn.active')?.dataset.mood || 'casual';
  const context = document.getElementById("context")?.value || 'normal';
  const crushName = document.getElementById("crush-name")?.value.trim() || '';
  
  // Check if it's a new message type
  let messagesArray;
  if (enhancedMessages[currentLang] && enhancedMessages[currentLang][type]) {
    messagesArray = enhancedMessages[currentLang][type];
  } else if (messages[currentLang] && messages[currentLang][type]) {
    messagesArray = messages[currentLang][type];
  } else {
    messagesArray = messages[currentLang]?.random || ['Hello! ğŸ‘‹'];
  }
  
  // Filter by mood (for new types)
  if (enhancedMessages[currentLang] && enhancedMessages[currentLang][type]) {
    messagesArray = filterByMood(messagesArray, mood);
  }
  
  // Get message with anti-repetition
  let recentItems = JSON.parse(localStorage.getItem('namerly-crush-recent')) || [];
  let selectedMessage = getUniqueMessage(messagesArray, recentItems);
  
  // Apply context modifications
  if (context !== 'normal' && contextModifiers[currentLang] && contextModifiers[currentLang][context]) {
    selectedMessage = contextModifiers[currentLang][context](selectedMessage);
  }
  
  // Add personalization with name
  if (crushName) {
    selectedMessage = personalizeMessage(selectedMessage, crushName);
  }
  
  // Display enhanced output
  displayEnhancedOutput(selectedMessage, type, translations, currentLang);
  
  // Show random tip
  showRandomTip(currentLang);
  
  // Track usage
  if (window.trackGenerator) {
    window.trackGenerator('crush', { type, mood, hasName: !!crushName });
  }
  
  console.log('âœ… Enhanced message generated:', selectedMessage);
}

function filterByMood(messages, mood) {
  // Simple mood filtering - in a real app you'd tag messages by mood
  switch (mood) {
    case 'romantic':
      return messages.filter((msg, i) => i % 4 === 0 || msg.includes('ğŸ’•') || msg.includes('heart') || msg.includes('corazÃ³n'));
    case 'playful':
      return messages.filter((msg, i) => i % 4 === 1 || msg.includes('ğŸ˜Š') || msg.includes('ğŸ˜') || msg.includes('ğŸ˜‚'));
    case 'confident':
      return messages.filter((msg, i) => i % 4 === 2 || msg.includes('know') || msg.includes('sure') || msg.includes('sÃ© que'));
    default:
      return messages;
  }
}

function personalizeMessage(message, name) {
  // Simple name integration
  if (message.toLowerCase().startsWith('hey') || message.toLowerCase().startsWith('hi') || message.toLowerCase().startsWith('hola')) {
    return message.replace(/^(hey|hi|hola)/i, `$1 ${name}`);
  } else {
    return `${name}, ${message}`;
  }
}

function getUniqueMessage(messagesArray, recentItems) {
  const availableMessages = messagesArray.filter(msg => !recentItems.includes(msg));
  
  let selectedMessage;
  if (availableMessages.length === 0) {
    recentItems.length = 0; // Clear array
    selectedMessage = messagesArray[Math.floor(Math.random() * messagesArray.length)];
  } else {
    selectedMessage = availableMessages[Math.floor(Math.random() * availableMessages.length)];
  }
  
  recentItems.unshift(selectedMessage);
  if (recentItems.length > 8) {
    recentItems.splice(8); // Keep only first 8
  }
  
  localStorage.setItem('namerly-crush-recent', JSON.stringify(recentItems));
  return selectedMessage;
}

function displayEnhancedOutput(message, type, translations, currentLang) {
  const output = document.getElementById("output");
  if (!output) {
    console.error('Output element not found');
    return;
  }
  
  const isNewType = enhancedMessages[currentLang] && enhancedMessages[currentLang][type];
  const typeEmoji = {
    first_message: 'âœ¨',
    good_morning: 'ğŸŒ…',
    good_night: 'ğŸŒ™',
    flirty: 'ğŸ˜',
    sweet: 'ğŸ¯',
    funny: 'ğŸ˜‚',
    deep: 'ğŸ’­'
  };
  
  // Safe fallbacks for translations
  const copyText = (translations && translations[currentLang] && translations[currentLang].copy) || 'Copy';
  const shareText = (translations && translations[currentLang] && translations[currentLang].share) || 'Share';
  
  // Escape quotes for onclick
  const escapedMessage = message.replace(/'/g, "\\'").replace(/"/g, '\\"');
  
  output.innerHTML = `
    <div class="message-result ${isNewType ? 'enhanced' : ''}">
      <div class="message-type">${typeEmoji[type] || 'ğŸ’˜'} ${type.replace('_', ' ').toUpperCase()}</div>
      <div class="message-content">"${message}"</div>
      <div class="message-actions">
        <button class="copy-btn enhanced" onclick="copyEnhancedMessage('${escapedMessage}')">
          ${copyText} âœ¨
        </button>
        <button class="main-share-btn enhanced" onclick="toggleShareSection && toggleShareSection()">
          ${shareText} ğŸ“±
        </button>
        <button class="regenerate-btn" onclick="generateEnhancedMessage()">
          ğŸ”„ New One
        </button>
      </div>
    </div>
  `;
  
  // Show share section if it exists
  const shareSection = document.getElementById("share-section");
  if (shareSection) {
    shareSection.style.display = "block";
  }
}

function showRandomTip(currentLang) {
  const tips = crushTips[currentLang] || crushTips['en'];
  const randomTip = tips[Math.floor(Math.random() * tips.length)];
  const tipElement = document.getElementById("tip-text");
  if (tipElement) {
    tipElement.textContent = randomTip;
  }
}

function copyEnhancedMessage(text) {
  navigator.clipboard.writeText(text).then(() => {
    // Use new notification system if available
    if (window.notify) {
      window.notify.copySuccess(text, 'crush');
    } else {
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'âœ… Copied!';
      setTimeout(() => {
        btn.textContent = originalText;
      }, 1500);
    }
  });
}

// Mood selector functionality
document.addEventListener('DOMContentLoaded', () => {
  console.log('ğŸš€ Loading Crush Enhanced...');
  
  // Check if required elements exist
  const requiredElements = ['type', 'output'];
  const missingElements = requiredElements.filter(id => !document.getElementById(id));
  
  if (missingElements.length > 0) {
    console.error('âŒ Missing elements:', missingElements);
  } else {
    console.log('âœ… All required elements found');
  }
  
  // Mood button functionality
  document.querySelectorAll('.mood-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      console.log('Mood selected:', btn.dataset.mood);
    });
  });
  
  // Test if global variables are available
  setTimeout(() => {
    console.log('ğŸ” Checking global variables...');
    console.log('currentLang:', window.currentLang);
    console.log('messages available:', !!window.messages);
    console.log('translations available:', !!window.translations);
    
    // Initialize with a random tip
    const currentLang = window.currentLang || localStorage.getItem('namerly-crush-lang') || 'en';
    if (document.getElementById("tip-text")) {
      showRandomTip(currentLang);
    }
  }, 1000);
});

console.log('ğŸ’– Crush Enhanced Messages loaded!');
